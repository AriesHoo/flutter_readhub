# flutter_readhub

è¯¥é¡¹ç›®ä¸ºFlutterå®æˆ˜é¡¹ç›®,ä¸º[Readhub](https://readhub.me/)éå®˜æ–¹å®¢æˆ·ç«¯ã€‚

æ•°æ®æ¥æºäºReadhubå®˜æ–¹APIæ¥å£ã€‚**ç‰ˆæƒåŠæœ€ç»ˆè§£é‡Šæƒå½’Readhubå®˜æ–¹æ‰€æœ‰,å¦‚æœ‰ä¾µæƒè¯·é‚®ç®±è”ç³»åˆ é™¤!**

ä»…ä¾›å­¦ä¹ ä½¿ç”¨ï¼Œç¦æ­¢å•†ç”¨

>- **[ã€ ç®€ä¹¦ã€‘](https://www.jianshu.com/p/5e1db7423dac)**
>- **[ã€ æ˜é‡‘ã€‘](https://juejin.im/post/5ef5bb1fe51d4534bb148c67)**

## å‰è¨€

å­¦ä¹ Flutterä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯å½“æ—¶å­¦ä¹ è¿‡ç¨‹åšçš„ä¸€ä¸ªç»ƒæ‰‹é¡¹ç›®ï¼ˆ2019å¹´11æœˆ10æ—¥ï¼‰è¾¹åšè¾¹å­¦å¤§æ¦‚ç”¨äº†åŠä¸ªæœˆçš„æ—¶é—´å®Œæˆï¼Œè‡³äºä¸ºå•¥åˆ°ç°åœ¨æ‰å†™è¿™ç¯‡æ–‡ç« ã€‚è¿™æ˜¯ä¸€ä¸ªä¼¤å¿ƒğŸ’”çš„æ•…äº‹ï¼Œè¿˜ä¸æ˜¯å› ä¸ºç©·ä¹°ä¸èµ·MacğŸ˜‚ï¼Œæ²¡æœ‰åšiOSçš„é€‚é…æ£€æµ‹ã€‚æ„Ÿè§‰æ²¡æœ‰åšè¿‡iOSé€‚é…æ£€æµ‹çš„Flutteré¡¹ç›®æ˜¯ä¸å®Œæ•´çš„ï¼Œæ•…è¿™ä¸ªé¡¹ç›®ä¸€ç›´å°±æ‹–åœ¨é‚£é‡Œäº†ã€‚æ—¶éš”8ä¸ªæœˆç»ˆäºå¯ä»¥åšiOSé€‚é…æ£€æµ‹äº†ï¼ˆ**å½“ç„¶è¿˜æ˜¯ä¸æ˜¯è‡ªå·±çš„Macï¼Œå…¬å¸ç»™é…çš„ï¼Œä¸ºå…¬å¸ç‚¹èµğŸ‘**ï¼‰ï¼Œæ•…å°†è¿™ä¸ªé¡¹ç›®çš„å†ç¨‹åšä¸€ä¸ªé˜¶æ®µæ€§çš„æ€»ç»“ã€‚

## é¡¹ç›®ç®€ä»‹

åç§°ï¼š**Freadhub** ï¼šå³Flutterç‰ˆæœ¬çš„readhubã€‚[readhubå®˜ç½‘](https://www.readhub.cn/)

logoï¼š**å­—æ¯F(Flutter)+å­—æ¯R(readhub) ç»“åˆè“è‰²èƒŒæ™¯**-çµ(chao)æ„Ÿ(xi)æ¥è‡ªé˜¿é‡Œå·´å·´Flutterå¼€æºé¡¹ç›®[**FlutterGo**]([https://github.com/alibaba/flutter-go](https://github.com/alibaba/flutter-go)
)çš„logo

![Freadhub](https://upload-images.jianshu.io/upload_images/2828782-400c882f7c2b8013.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

sloganï¼š**Freadhub-åšè½»ä¾¿çš„èšåˆèµ„è®¯**

![slogan](https://upload-images.jianshu.io/upload_images/2828782-2b3f944f4f0dac93.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/400)

iOS: æ²¡æœ‰ğŸ˜¼(ä»€ä¹ˆæ²¡æœ‰iOSä¸‹è½½åœ°å€ï¼Œé‚£ä½ æ£€æµ‹ä¸ªä»€ä¹ˆiOSé€‚é…ğŸ˜‚)

Androidä¸‹è½½åœ°å€ï¼š[è’²å…¬è‹±ä¸‹è½½-å®‰è£…å¯†ç 1](https://www.pgyer.com/ntMA)

![è’²å…¬è‹±ä¸‹è½½-å®‰è£…å¯†ç 1](https://upload-images.jianshu.io/upload_images/2828782-ecc226516c58965e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## ä¸»è¦åŠŸèƒ½

Freadhub ä¸»è¦å›Šæ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š
**çƒ­é—¨è¯é¢˜**ã€**ç§‘æŠ€åŠ¨æ€**ã€**å¼€å‘è€…**ã€**åŒºå—é“¾**å››å¤§æ¨¡å—
ç›¸å…³èšåˆèµ„è®¯å¿«æ·æŸ¥çœ‹
æ–¹ä¾¿å¿«æ·çš„æµ…è‰²/æ·±è‰²æ¨¡å¼åˆ‡æ¢
ä¸°å¯Œçš„å½©è™¹é¢œè‰²ä¸»é¢˜/æ¯æ—¥ä¸»é¢˜åˆ‡æ¢
é•¿æŒ‰ç¤¾ä¼šåŒ–åˆ†äº«é¢„è§ˆå›¾æ•ˆæœæ¨¡å¼
æ–¹ä¾¿å¿«æ·çš„æ„è§åé¦ˆå…¥å£

æµ…è‰²ä¸»é¢˜ | æ·±è‰²ä¸»é¢˜ | 
-|-
![](https://upload-images.jianshu.io/upload_images/2828782-3ff1edcb6ebb2d1a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)  | ![](https://upload-images.jianshu.io/upload_images/2828782-ad56708cf1abda96.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/600) 
èµ„è®¯è¯¦æƒ…| æ›´å¤šæ“ä½œ | 
| ![](https://upload-images.jianshu.io/upload_images/2828782-adeee853d0acb8dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)| ![](https://upload-images.jianshu.io/upload_images/2828782-ab5cee42e37dc09a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)
 | é€‰æ‹©ä¸»é¢˜ | ç¤¾äº¤åˆ†äº« |
 ![](https://upload-images.jianshu.io/upload_images/2828782-cd035d26c531bf6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)| ![](https://upload-images.jianshu.io/upload_images/2828782-0b27841d2d8b082b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)|

## ä¸»è¦åŠŸèƒ½å®ç°

è¯¥é¡¹ç›®ä¸»è¦ä½¿ç”¨`dio`åº“è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œ`provider`è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼›æ¯”è¾ƒç²¾å·§åŠè½»ä¾¿æœ¬èº«åŠŸèƒ½æ¯”è¾ƒå°‘ä½†å®ç”¨ã€‚è¿™é‡ŒæŒ‘é€‰å‡ ä¸ªä¸»è¦åŠŸèƒ½å®ç°æ¥ç®€è¦æ¦‚è¿°ä¸‹ã€‚

### ä¸ƒè‰²å½©è™¹ä¸»é¢˜åˆ‡æ¢åŠæ·±è‰²æ¨¡å¼-Androidè™šæ‹Ÿå¯¼èˆªæ é¢œè‰²

**æ·±è‰²æ¨¡å¼**ï¼šFlutteræä¾›äº†æ–¹ä¾¿çš„æµ…è‰²/æ·±è‰²ä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢ç›¸å…³å…¥å£ï¼š`MaterialApp`ä¸‹çš„`theme`åŠ`darkTheme`å…¥å£ç”¨äºè®¾ç½®`ThemeData`ç”¨äºæ§åˆ¶å‡ ä¹æ‰€æœ‰çš„Widgeté¢œè‰²åŠä¸»é¢˜ï¼›Flutterä¼šæ ¹æ®ç³»ç»Ÿ`ï¼ˆiOS 13åŠä»¥ä¸Šç‰ˆæœ¬ã€Android 10åŠä»¥ä¸Šç‰ˆæœ¬åŸç”Ÿæ”¯æŒæ·±è‰²æ¨¡å¼ï¼‰`å½“å‰ä¸»é¢˜è®¾ç½®è‡ªåŠ¨è°ƒç”¨å¯¹åº”themeæˆ–darkThemeè®¾ç½®çš„ThemeDataå±æ€§è¿›è¡ŒWidgetä¸»é¢˜åˆ‡æ¢æ“ä½œã€‚è¯¥éƒ¨åˆ†å¯å‚è€ƒ [Flutteré€‚é…æ·±è‰²æ¨¡å¼ï¼ˆDarkModeï¼‰](https://www.jianshu.com/p/76539f98b146)

**ä¸»åŠ¨åˆ‡æ¢é¢œè‰²ä¸»é¢˜åŠæ·±è‰²ä¸»é¢˜**ï¼šFreadhubæä¾›äº†**è‡ªåŠ¨åˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜**ï¼ˆå¦‚æœç³»ç»Ÿè®¾ç½®äº†æ·±è‰²æ¨¡å¼ä¼˜å…ˆï¼‰åŠ ä¸ƒè‰²å½©è™¹ç³»é¢œè‰²ä¸»é¢˜è®¾ç½®ï¼ˆiconåŠéƒ¨åˆ†æ–‡å­—é¢œè‰²åŠtabä¸‹åˆ’çº¿ï¼‰å¯é€‰æ‹©å›ºå®šçš„é¢œè‰²ä¹Ÿå¯é€‰æ‹©æ¯å¤©é¡ºåºå˜åŒ–ã€‚ä¸»è¦æµç¨‹åˆ™æ˜¯åˆ›å»ºä¸€ä¸ª`ThemeViewModel`ç±»ç»§æ‰¿`ChangeNotifier`ï¼ˆä»¥ä¾¿åœ¨é€‰æ‹©`Color`å€¼åè°ƒç”¨notifyListenersè¿›è¡Œwidgetåˆ·æ–°ï¼‰->é€‰æ‹©å¯¹åº”çš„ä¸»é¢˜é¢œè‰²å€¼ ->è°ƒç”¨`ThemeViewModel `çš„`notifyListeners`æ–¹æ³•é€šçŸ¥widgetåˆ·æ–° 

1ã€å…¥å£widgetè®¾ç½®`MaterialApp`ä¸‹çš„`theme`åŠ`darkTheme`å¯¹åº”çš„`ThemeData`æ¥è‡ª`ThemeViewModel`æ–¹æ³•è¿”å›ã€‚ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š
~~~
@override
  Widget build(BuildContext context) {
    return BasisProviderWidget2<ThemeViewModel, LocaleViewModel>(
      model1: ThemeViewModel(),
      model2: LocaleViewModel(),
      builder: (context, theme, locale, child) => MaterialApp(
        ///å…¨å±€ä¸»é¢˜é…ç½®
        theme: theme.themeData(),
        ///å…¨å±€é…ç½®æ·±è‰²ä¸»é¢˜
        darkTheme: theme.themeData(platformDarkMode: true)ï¼Œ
        ///å›½é™…åŒ–è¯­è¨€
        locale: locale.locale,
        localizationsDelegates: [
          S.delegate,
          ///ä¸‹æ‹‰åˆ·æ–°åº“å›½é™…åŒ–é…ç½®
          RefreshLocalizations.delegate,
          ///ä¸é…ç½®è¯¥é¡¹ä¼šåœ¨EditFieldç‚¹å‡»å¼¹å‡ºå¤åˆ¶ç²˜è´´å·¥å…·æ—¶æŠ›å¼‚å¸¸ The getter 'cutButtonLabel' was called on null.
          GlobalCupertinoLocalizations.delegate,
          GlobalMaterialLocalizations.delegate,
          GlobalWidgetsLocalizations.delegate
        ],
        supportedLocales: S.delegate.supportedLocales,
        ///å¯åŠ¨é¡µæ˜¾ç¤ºslogan
        home: SplashPage(),
      ),
    );
~~~

2ã€`ThemeViewModel`è·å–`ThemeData`æ–¹æ³•ä¸»è¦ä»£ç 

~~~
///æ ¹æ®ä¸»é¢˜ æ˜æš— å’Œ é¢œè‰² ç”Ÿæˆå¯¹åº”çš„ä¸»é¢˜[dark]ç³»ç»Ÿçš„Dark Mode
themeData({bool platformDarkMode: false}) {
    var isDark = platformDarkMode || _userDarkMode;
    var themeColor = _themeColor;
    _accentColor = isDark ? themeColor[600] : _themeColor;
    Brightness brightness = isDark ? Brightness.dark : Brightness.light;
    var themeData = ThemeData(
      ///ä¸»é¢˜æµ…è‰²æˆ–æ·±è‰²
      brightness: brightness,
      primaryColorBrightness: brightness,
      accentColorBrightness: brightness,
      primarySwatch: themeColor,
      ///å¼ºè°ƒè‰²
      accentColor: accentColor,
      primaryColor: accentColor,
    );
    themeData = themeData.copyWith(
        ///appBarä¸»é¢˜
      appBarTheme: themeData.appBarTheme.copyWith(
        ///æ ¹æ®ä¸»é¢˜è®¾ç½®Appbaræ ·å¼èƒŒæ™¯
        color: isDark ? colorBlackTheme : Colors.white,
        ///å»æ‰æµ·æ‹”é«˜åº¦
        elevation: 0,
        ///æ–‡æœ¬æ ·å¼
        textTheme: TextTheme(
          ///title Textæ ·å¼
          subtitle1: TextStyle(
            color: isDark ? Colors.white : accentColor,
            fontSize:17,
            fontWeight: FontWeight.w500,
            ///å­—ä½“
            fontFamily: fontValueList[_fontIndex],
          ),
          ///action Textæ ·å¼
          bodyText2: TextStyle(
            color: isDark ? Colors.white : accentColor,
            fontSize:13,
            fontWeight: FontWeight.w500,
            ///å­—ä½“
            fontFamily: fontValueList[_fontIndex],
          ),
        ),
        ///iconæ ·å¼
        iconTheme: IconThemeData(
          color: isDark ? Colors.white : accentColor,
        ),
      ),
      ///å…¨å±€icon
      iconTheme: themeData.iconTheme.copyWith(
        color: accentColor,
      ),
      ///é•¿æŒ‰æç¤ºæ–‡æœ¬æ ·å¼
      tooltipTheme: themeData.tooltipTheme.copyWith(
          textStyle: TextStyle(
              fontSize: 13,
              color:
                  (darkMode ? Colors.black : Colors.white).withOpacity(0.9))),
      ///TabBaræ ·å¼è®¾ç½®
      tabBarTheme: themeData.tabBarTheme.copyWith(
        ///æ ‡ç­¾å†…è¾¹è·
        labelPadding: EdgeInsets.symmetric(horizontal: 8),
        ///é€‰ä¸­labelæ ·å¼
        labelStyle: TextStyle(
          fontWeight: FontWeight.w600,
          fontSize: 14,
        ),
        ///æœªé€‰ä¸­labelæ ·å¼
        unselectedLabelStyle: TextStyle(
          fontWeight: FontWeight.normal,
          fontSize: 13,
        ),
      ),
      ///floatingActionButtonæ ·å¼
      floatingActionButtonTheme: themeData.floatingActionButtonTheme.copyWith(
        ///èƒŒæ™¯è‰²
        backgroundColor: themeAccentColor,
        ///æ°´æ³¢çº¹é¢œè‰²
        splashColor: themeColor.withAlpha(50),
      ),
    );
    setSystemBarTheme();
    return themeData;
  }
~~~

**3ã€é€‰æ‹©Colorä¸»é¢˜,é€šçŸ¥ä¸»widgetæ›´æ–°**

~~~
/// åˆ‡æ¢æŒ‡å®šè‰²å½©ï¼›æ²¡æœ‰ä¼ [brightness]å°±ä¸æ”¹å˜brightness,coloråŒç†
  void switchTheme(
      {bool userDarkMode, int themeIndex, MaterialColor color}) async {
    if (themeIndex != null && themeIndex != _themeIndex) {
      SpUtil.putInt(SP_KEY_THEME_COLOR_INDEX, themeIndex);
    }
    _userDarkMode = userDarkMode ?? _userDarkMode;
    _themeIndex = themeIndex ?? _themeIndex;
    _themeColor = color ?? getThemeColor();
    ///å­˜å…¥ç¼“å­˜
    SpUtil.putBool(SP_KEY_THEME_DARK_MODE, _userDarkMode);
    notifyListeners();
  }
~~~

**4ã€Android è™šæ‹Ÿå¯¼èˆªæ é¢œè‰²æ§åˆ¶ï¼ˆå°±æ˜¯Androidæ¨¡æ‹Ÿå™¨ç»å¸¸å‡ºç°çš„é‚£ä¸ªåº•éƒ¨é»‘è‰²å¯¼èˆªæ ï¼‰**

![è™šæ‹Ÿå¯¼èˆªæ ](https://upload-images.jianshu.io/upload_images/2828782-f88ddfaa72b26730.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)

æ¯”è¾ƒé—æ†¾çš„æ˜¯ï¼š

1ã€ç›®å‰å¸‚é¢ä¸Šç»å¤§å¤šæ•°çš„åº”ç”¨éƒ½æ˜¯æ²¡æœ‰åšè™šæ‹Ÿå¯¼èˆªæ é€‚é…çš„ï¼ˆå¯èƒ½è·Ÿç›®å‰å¸‚é¢ä¸Šçš„æ‰‹æœºå¤§å¤šéƒ½æ˜¯å…¨é¢å±æ²¡äººå…³å¿ƒè¿™ä¸ªå§ï¼‰

2ã€Flutter `ThemeData`é‡Œæ²¡æœ‰ä¸“é—¨è®¾ç½®è™šæ‹Ÿå¯¼èˆªæ é¢œè‰²çš„å±æ€§ï¼Œè®²é“ç†`ThemeData`é‡Œé¢çš„
`brightness`å±æ€§ç†åº”åŒæ—¶æ§åˆ¶çŠ¶æ€æ æ–‡å­—é¢œè‰²åŠiconé¢œè‰²ä»¥åŠåº•éƒ¨çš„è™šæ‹Ÿå¯¼èˆªæ èƒŒæ™¯åŠiconé¢œè‰²çš„ã€‚ä½†æ˜¯Flutterå®˜æ–¹ä¸è®²é“ç†

å¥½åœ¨Flutteræä¾›äº†å…¶å®ƒæ–¹å¼æ¥æ›´æ”¹ç³»ç»Ÿæ çš„é¢œè‰²ï¼Œé‚£å°±æ˜¯ `SystemChrome.setSystemUIOverlayStyle`
è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª `SystemUiOverlayStyle `æ ·å¼ç”¨äºæ§åˆ¶ç³»ç»ŸUIï¼ˆå³çŠ¶æ€æ åŠå¯¼èˆªæ ï¼‰å…¶ä¸­`systemNavigationBarColor`ç”¨äºæ§åˆ¶å¯¼èˆªæ èƒŒæ™¯è‰² `systemNavigationBarIconBrightness`ç”¨äºæ§åˆ¶å¯¼èˆªæ iconæ·±/æµ…è‰²ã€‚åœ¨è°ƒç”¨åˆ‡æ¢ä¸»é¢˜æ—¶åŒæ—¶è°ƒç”¨ `SystemChrome.setSystemUIOverlayStyle`å³å¯

~~~
 ///è®¾ç½®ç³»ç»ŸBarä¸»é¢˜
  static Future setSystemBarTheme() async {
    bool statusEnable =
        Platform.isAndroid ? await PlatformUtil.isStatusColorChange() : true;
    bool navigationEnable = Platform.isAndroid
        ? await PlatformUtil.isNavigationColorChange()
        : true;
    SystemChrome.setSystemUIOverlayStyle(SystemUiOverlayStyle(
      ///çŠ¶æ€æ èƒŒæ™¯è‰²
      statusBarColor: darkMode || statusEnable ? Colors.transparent : null,
      ///çŠ¶æ€æ icon äº®åº¦ï¼ˆæµ…è‰²/æ·±è‰²ï¼‰
      statusBarIconBrightness: darkMode ? Brightness.light : Brightness.dark,
      ///å¯¼èˆªæ é¢œè‰²
      systemNavigationBarColor: darkMode
          ? colorBlackTheme
          : navigationEnable ? Colors.transparent : null,
      ///å¯¼èˆªæ iconï¼ˆæµ…è‰²/æ·±è‰²ï¼‰
      systemNavigationBarIconBrightness:
          darkMode ? Brightness.light : Brightness.dark,
    ));
  }
~~~

 ![å¯¼èˆªæ é¢œè‰²](https://user-gold-cdn.xitu.io/2020/6/26/172efe2e4416db12?w=436&h=892&f=gif&s=5501033)

æ˜¯ä¸æ˜¯é¡¿æ—¶æ„Ÿè§‰å¥½ä¸å°‘å•Šï¼ˆå¥½å¼€æ£®ğŸ˜„ï¼‰

ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä»ç³»ç»Ÿåˆ‡æ¢æ·±è‰²ä¸»é¢˜ä¼šæ€æ ·å‘¢ï¼Ÿ

![æ·±è‰²æ¨¡å¼å¼‚å¸¸](https://user-gold-cdn.xitu.io/2020/6/26/172efe2e4f9327fa?w=436&h=892&f=gif&s=9872093)

å°¼ç›å’‹æ·±è‰²æ¨¡å¼ä¸‹å¯¼èˆªæ è¿˜æ˜¯æµ…è‰²çš„ï¼Œå¥½çªå…€ã€‚
è¿™ä¸ªå°±æ˜¯å‰é¢è¯´åˆ°çš„å› ä¸ºFlutter `ThemeData`é‡Œæ²¡æœ‰ä¸“é—¨è®¾ç½®è™šæ‹Ÿå¯¼èˆªæ é¢œè‰²çš„å±æ€§ï¼Œæ‰€ä»¥å½“ç³»ç»Ÿåˆ‡æ¢æ·±è‰²æ¨¡å¼å¯¼èˆªæ æ²¡æœ‰ä»»ä½•å˜åŒ–
è¿™å’‹æ•´ï¼Ÿ

è¿™é‡Œç¬”è€…å°è¯•äº†ä¸å°‘ï¼Œå¦‚å‰åå°ç›‘å¬-è¿™ä¸ªåªé€‚åˆå»è®¾ç½®é¡µé‡Œé¢æ§åˆ¶å†è¿”å›ï¼Œåƒè¿™ç§ä»é€šçŸ¥æ æ“ä½œçš„Appæœªè¿›è¡Œå‰åå°åˆ‡æ¢ï¼Œä¸èƒ½åšç›¸åº”çš„æ“ä½œã€‚æœ€ç»ˆæ‰¾åˆ°å½“ç³»ç»Ÿä¸»é¢˜åˆ‡æ¢ä¼šå›è°ƒ `StatefulWidget`çš„`didUpdateWidget`æ–¹æ³•ï¼Œé‚£ä¸æ˜¯å¯ä»¥åœ¨é‡Œé¢åšç›¸åº”æ“ä½œï¼Ÿè¯´è¯•å°±è¯•

~~~
@override
  void didUpdateWidget(HomePage oldWidget) {
    super.didUpdateWidget(oldWidget);
    LogUtil.e('home_page_didUpdateWidget');
    ///æ›´æ–°UI--åœ¨æ·±è‰²æš—è‰²æ¨¡å¼åˆ‡æ¢æ—¶å€™ä¹Ÿä¼šè§¦å‘å› ThemeDataæ— NavigationBarç›¸å…³ä¸»é¢˜é…ç½®æ•…é‡‡ç”¨è¯¥æ–¹æ³•è¿‚å›å¤„ç†
    if (_lastSetSystemUiAt == null ||
        DateTime.now().difference(_lastSetSystemUiAt) >
            Duration(milliseconds: 1000)) {
      ///ä¸¤æ¬¡ç‚¹å‡»é—´éš”è¶…è¿‡é˜ˆå€¼åˆ™é‡æ–°è®¡æ—¶
      _lastSetSystemUiAt = DateTime.now();
      LogUtil.e('è®¾ç½®ç³»ç»Ÿæ é¢œè‰²');
      ThemeViewModel.setSystemBarTheme();
    }
  }
~~~

![æ·±è‰²æ¨¡å¼æ­£å¸¸](https://upload-images.jianshu.io/upload_images/2828782-8ae67f3936c095a0.gif?imageMogr2/auto-orient/strip)

å“ˆå“ˆï¼Œç»ˆäºæ­£å¸¸äº†ï¼è¿™é‡Œç¬”è€…é‡‡ç”¨äº†ä¸€ä¸ªè¿‚å›ç¬¨çš„æ–¹å¼ï¼Œå¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼è¯·ä¸åèµæ•™ï¼Œæ„Ÿè°¢ğŸ™

### å­—ä½“å¤§å°æ§åˆ¶ 

Freadhubè¿˜æä¾›äº†èµ„è®¯åˆ—è¡¨æ ‡é¢˜åŠç®€ä»‹å­—ä½“å¤§å°æ§åˆ¶çš„åŠŸèƒ½ï¼Œä¸»è¦é€šè¿‡ `Text ` widgetçš„`textScaleFactor`å±æ€§æ§åˆ¶,å…¨å±€è®¾ç½®`articleTextScaleFactor`å€¼ä¿®æ”¹åå†åˆ·æ–°Widgetå³å¯

![å­—ä½“å¤§å°æ§åˆ¶](https://upload-images.jianshu.io/upload_images/2828782-645d7b58849d2be1.gif?imageMogr2/auto-orient/strip)


### é•¿æŒ‰åˆ†äº«èµ„è®¯åŠŸèƒ½

è¯¥åŠŸèƒ½æ¶‰åŠ `æˆªå±`ã€`è®¿é—®å­˜å‚¨æƒé™`ã€`ä¿å­˜å›¾ç‰‡`ã€`åˆ†äº«å›¾ç‰‡`ç­‰å››ä¸ªä¸»ä½“åŠŸèƒ½

**1ã€æˆªå±**

Flutteræä¾›ä¸“é—¨ç”¨äºæˆªå±çš„widget `RepaintBoundary`åªéœ€å°†éœ€è¦æˆªå±çš„widgetç”¨`RepaintBoundary`åŒ…è£¹ç„¶å`GlobalKey`å¯ä»¥æ‹¿åˆ°`RenderRepaintBoundary`çš„å¼•ç”¨å¹¶å°†å…¶è½¬åŒ–æˆå›¾ç‰‡æ•°æ®`Uint8List`å³å¯è¿›è¡Œåç»­çš„ä¿å­˜å›¾ç‰‡åŠåˆ†äº«åŠŸèƒ½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å°†`RenderRepaintBoundary`è½¬åŒ–æˆImageèµ„æºæ—¶éœ€è®¾ç½®å¥½pixelRatioä¸€èˆ¬è·å–è®¾å¤‡åƒç´ æ¯”ä¸ç„¶æœ€ç»ˆå›¾ç‰‡æ˜¾ç¤ºå¯èƒ½ä¸æ¸…æ¥šæˆ–è€…å¤ªå¤§ã€‚è¿™å—ç½‘ä¸Šä¾‹å­å¾ˆå¤šã€‚

~~~
    RenderRepaintBoundary boundary = globalKey.currentContext.findRenderObject();
    ///å¼¹æ¡†å®½åº¦ä¸å±å¹•å®½åº¦æ¯”å€¼é¿å…æˆªå›¾å‡ºæ¥æ¯”é¢„è§ˆæ›´å¤§
    ///åˆ†è¾¨ç‡é€šè¿‡è·å–è®¾å¤‡çš„devicePixelRatioä»¥è¾¾åˆ°æ¸…æ™°åº¦è‰¯å¥½
    var image = await boundary.toImage(pixelRatio: (MediaQuery.of(context).devicePixelRatio));
    ///è½¬äºŒè¿›åˆ¶
    ByteData byteData = await image.toByteData(format: ImageByteFormat.png);
    ///å›¾ç‰‡æ•°æ®
    pngBytes = byteData.buffer.asUint8List();
~~~

**2ã€è®¿é—®å­˜å‚¨æƒé™**

Freadhubä½¿ç”¨çš„æ˜¯ä¸‰æ–¹åº“[`permission_handler`](https://pub.flutter-io.cn/packages/permission_handler)æ¥å®ŒæˆAndroidç«¯`Permission.storage`ã€iOSç«¯`Permission.photos`æƒé™ç”³è¯·ï¼Œè¿™ä¸ªåº“åšå¾—æ¯”è¾ƒä¸é”™ï¼Œå¦‚æœæ‹’ç»äº†è¿˜æä¾›äº†è·³è½¬è®¾ç½®æƒé™é¡µæ–¹æ³•ã€‚

~~~
  /// ç”³è¯·æƒé™
  static Future<bool> checkPermission(Permission permission) async {
    PermissionStatus status = await permission.status;
    if (status != PermissionStatus.granted) {
      status = await permission.request();
      return status == PermissionStatus.granted;
    } else {
      return true;
    }
  }

  ///æ–‡ä»¶è¯»å†™android storage iOS photos
  static Future<bool> checkStoragePermission() async {
    return checkPermission(
        Platform.isAndroid ? Permission.storage : Permission.photos);
  }
~~~

Androidç«¯çš„è¿˜å¥½ï¼Œæ¯•ç«ŸåšAndroidå‡ºèº«çš„ï¼ŒiOSçš„é€‚é…è¿˜æ˜¯å‡ºäº†ä¸ªå°æ’æ›²ï¼ˆå…¶å®ä¹Ÿæ€ªè‡ªå·±çš„è‹±è¯­å¤ªçƒ‚æ²¡æ³¨æ„ğŸ˜‚è€Œè‡ªå·±æƒ³å½“ç„¶çš„è§‰å¾—äº†ï¼‰ã€‚è¿™é‡Œè¯´ä¸€ä¸‹é¿å‘
[permission-handler github](https://github.com/Baseflow/flutter-permission-handler)å®˜ç½‘ iOSçš„1ã€2æ­¥å¯ä»¥å¿½ç•¥(å®˜ç½‘çš„1ã€2æ­¥æ„æ€æ˜¯ä¸éœ€è¦çš„æƒé™å¯å°†å…¶ç§»é™¤ï¼›å½“æ—¶åšçš„æ—¶å€™æ²¡æœ‰ç»†çœ‹å°±è‡ªä»¥ä¸ºçš„è§‰å¾—æ˜¯éœ€è¦å•¥æƒé™å°±æ·»åŠ è¿›å»å°†æ³¨é‡Šå»æ‰ï¼Œå¯èƒ½æ˜¯æƒ¯æ€§æ€ç»´ğŸ˜¼),ç›´æ¥åœ¨`Info.plist`æ·»åŠ ä½¿ç”¨ç…§ç‰‡æè¿°å³å¯

~~~
<key>NSPhotoLibraryUsageDescription</key>
<string>ä¿å­˜å›¾ç‰‡åˆ°è®¾å¤‡ï¼Œéœ€è¦è°ƒç”¨ä½ çš„ç…§ç‰‡åŠŸèƒ½</string>
~~~

**3ã€ä¿å­˜å›¾ç‰‡**

Freadhubä½¿ç”¨ä¸‰æ–¹åº“ `path_provider`ç”¨äºè·å–æœ¬åœ°æ–‡ä»¶è·¯å¾„å¹¶é€šè¿‡`File`å¯¹è±¡å°†æ­¥éª¤ä¸€è·å–åˆ°çš„å›¾ç‰‡æ•°æ®`Uint8List`ä¿å­˜åˆ°å¯¹åº”æ–‡ä»¶å¤¹å³å¯ï¼›
ç‰¹æ®Šè¯´æ˜:å»å¹´åšçš„ç‰ˆæœ¬æ˜¯ç”¨çš„ä¸€ä¸ªä¸‰æ–¹åº“å°†å›¾ç‰‡ä¿å­˜åˆ°æ‰‹æœºå›¾åº“ç„¶åè¿›è¡Œåˆ†äº«æ“ä½œï¼Œæœ€è¿‘åšiOSé€‚é…æ£€æµ‹æ—¶å‘ç°iOSä¿å­˜å›¾åº“æ²¡æœ‰è¿”å›Fileè·¯å¾„è¿™æ ·å°±æ— æ³•è¿›è¡Œå›¾ç‰‡Fileçš„åˆ†äº«ã€‚å¦å¤–è¿™ç§ä¿å­˜å›¾åº“åŠŸèƒ½æ˜¯è°ƒç”¨ä¸€æ¬¡åˆ™è¿›è¡Œä¸€æ¬¡ä¿å­˜æ“ä½œä¼šé€ æˆåŒä¸€å›¾ç‰‡å¤šæ¬¡ä¿å­˜æƒ…å†µï¼Œé€ æˆå†…å­˜çš„æµªè´¹ã€‚æ•…ç°ä½¿ç”¨Fileä¿å­˜é€šè¿‡ä½¿ç”¨åŒä¸€æ–‡ä»¶åä»¥ä¾¿åŒä¸€å›¾ç‰‡å¤šæ¬¡ä¿å­˜çš„é—®é¢˜ã€‚
ä½†æ˜¯è¿™é€ æˆå¦ä¸€ä¸ªé—®é¢˜ï¼š**iOSåº”ç”¨åˆ›å»ºçš„ç§æœ‰æ–‡ä»¶ä¸èƒ½è¢«å…¶å®ƒåº”ç”¨ä½¿ç”¨ğŸ˜‚**ï¼›æ•…ï¼šiOSåªæä¾›åˆ†äº«æŒ‰é’®ï¼Œç”¨æˆ·å¯åœ¨å¼¹å‡ºæ¡†é€šè¿‡é€‰æ‹©`Save Image`è¿›è¡Œä¿å­˜å›¾åº“ç„¶åå…¶å®ƒåº”ç”¨å¯ä½¿ç”¨ã€‚

~~~
    ///ä¿å­˜å›¾ç‰‡åˆ°ç³»ç»Ÿå›¾åº“
    File saveFile = File(await getImagePath(imageName));
    bool exist = saveFile.existsSync() && saveFile.lengthSync() > 0;
    if (!exist) {
      if (!saveFile.existsSync()) {
        await saveFile.create();
      }
      File file = await saveFile.writeAsBytes(pngBytes);
      exist = file.existsSync();
    }
    if (exist) {
      fileImage = saveFile.absolute.path;
      saveImage(context, globalKey, imageName, share: share);
      return;
    }
~~~

**4ã€åˆ†äº«å›¾ç‰‡**

Flutterå®˜æ–¹æä¾›çš„`share`åªæä¾›ç®€å•çš„æ–‡å­—åˆ†äº«ï¼Œæ•…Freadhubä½¿ç”¨ä¸‰æ–¹åº“`flutter_share_plugin`ã€‚

~~~
 FlutterShare.shareFileWithText(
            filePath: fileImage, textContent: StringHelper.getS().saveImageShareTip);
~~~

AndroidçœŸæœº | iPadçœŸæœº | 
-|-
|![](https://upload-images.jianshu.io/upload_images/2828782-d5f3de7cb537df84.gif?imageMogr2/auto-orient/strip)| ![](https://upload-images.jianshu.io/upload_images/2828782-bf9d6fddc637bc8c.gif?imageMogr2/auto-orient/strip)|

### Android åº”ç”¨å‡çº§

Androidç«¯Appæ”¾åœ¨è’²å…¬è‹±ä¸Šçš„ï¼Œæ•…ä¹Ÿåšäº†ä¸€ä¸ªè’²å…¬è‹±çš„æ£€æµ‹åº”ç”¨ç‰ˆæœ¬å‡çº§çš„åŠŸèƒ½ã€‚
æœ‰æ–°ç‰ˆæœ¬åˆ™è·³è½¬æµè§ˆå™¨ç”±ç”¨æˆ·è‡ªå·±é€‰æ‹©ä¸‹è½½å®‰è£…ã€‚

![Androidåº”ç”¨æ›´æ–°](https://upload-images.jianshu.io/upload_images/2828782-f2afc893c2b7867b.gif?imageMogr2/auto-orient/strip)

## ä½¿ç”¨åˆ°çš„ä¸‰æ–¹åº“

èƒ½åšæˆè¿™ä¸ªFreadhubå°åº”ç”¨ç¦»ä¸å¼€è¿™äº›ä¸‰æ–¹åº“ï¼Œåœ¨æ­¤æ„Ÿè°¢è¿™äº›ä¸‰æ–¹åº“çš„ä½œè€…ğŸ™

~~~
  #  å›½é™…åŒ–æ”¯æŒ
  flutter_localizations:
    sdk: flutter
  # çŠ¶æ€ç®¡ç†State
  provider: ^3.2.0
  #  åå¸toast
  oktoast: ^2.2.0
  #  è®¾å¤‡ä¿¡æ¯
  device_info: ^0.4.2+4
  #  åº”ç”¨åŒ…ä¿¡æ¯
  package_info: ^0.4.1

  # WebView
  webview_flutter: ^0.3.22+1
  #  ç½‘ç»œè¯·æ±‚ç›¸å…³dio
  dio: ^3.0.9
  #  åŠ è½½ç½‘ç»œå›¾ç‰‡
  cached_network_image: ^2.2.0+1
  synchronized: ^2.1.0+1
  #  ä¸‹æ‹‰åˆ·æ–°
  pull_to_refresh: ^1.6.0
  #  æœ¬åœ°ç¼“å­˜sp
  shared_preferences: ^0.5.7+3
  # ç”¨äºåšéª¨æ¶å±-é—ªå…‰æ•ˆæœ
  shimmer: ^1.1.1
  #  è·³è½¬ç³»ç»Ÿæµè§ˆå™¨/æ‰“ç”µè¯ç­‰
  url_launcher: ^5.4.11
  #  äºŒç»´ç -ç”Ÿæˆ
  qr_flutter: ^3.2.0
  #  å·¥å…·ç±»
  flustars: ^0.3.2
  #  åŠ¨æ€æƒé™ç”³è¯·
  permission_handler: ^5.0.1
  #  æ–‡ä»¶è·¯å¾„
  path_provider: ^1.6.11
  #  åˆ†äº«æ–‡å­—åŠæ–‡ä»¶-æ³¨æ„ä¿å­˜æ–‡ä»¶ä½ç½®
  flutter_share_plugin: ^0.1.3+3
~~~

åŠŸèƒ½ä¸å¤šï¼Œç”¨åˆ°çš„ä¸‰æ–¹åº“è¿˜çœŸä¸å°‘ğŸ˜„

## å­˜åœ¨çš„å‘

1ã€Android ç›¸åŒçš„é…ç½®releaseæ‰“åŒ…å¤„æ¥çš„versionCodeå’Œdebugä¸ä¸€è‡´è€Œä¸”æ˜¯ç›´æ¥åŠ 1000çš„é‚£ç§ï¼ˆæ¯”å¦‚å½“å‰versionCodeä¸º4 releaseæ‰“åŒ…å‡ºæ¥ä¸º1004ï¼‰-ç½‘ä¸Šæ²¡æœ‰æœåˆ°å…¶ä»–äººæœ‰ç±»ä¼¼ç–‘é—®ä¹Ÿæ²¡æœ‰æ‰¾åˆ°åŸå› ã€‚

2ã€iOSçš„ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½ä¸ç®¡æ¨¡æ‹Ÿå™¨è¿˜æ˜¯çœŸæœºæµ‹è¯•æ€»ä¼šå¾ˆå®¹æ˜“å‡ºç°åŠ¨ç”»åŠåº”ç”¨é¡µé¢å¡é¡¿çš„æƒ…å†µ

3ã€iOSè¿è¡ŒçœŸæœºè¿‡ä¸€ä¼šå„¿æ•´ä¸ªAndroid Studioä¼šå®Œå…¨æ— å“åº”éœ€è¦æ€è¿›ç¨‹æ‰å¯ä»¥å…³æ‰

ä»¥ä¸Šå°±æ˜¯Freadhubå¼€å‘è¿‡ç¨‹é‡åˆ°çš„ç›®å‰è¿˜æœªæœ‰è§£å†³çš„ç–‘æƒ‘å‘ç‚¹ï¼Œå¦‚æœæœ‰æœ‹å‹çŸ¥é“å¸Œæœ›è§£ä¸‹å°å¼Ÿçš„ç–‘æƒ‘ï¼Œæ„Ÿè°¢ğŸ™


##  å·¥å…·æ¨è

åšè¿™ä¸ªFreadhubè¿‡ç¨‹è¿˜æ˜¯ç”¨äº†ä¿©ä¸é”™çš„å°å·¥å…·ï¼Œåœ¨è¿™é‡Œç»™å¤§å®¶æ¨èä¸‹ã€‚

1ã€[Image Asset Icon Resizer Lite](https://apps.apple.com/cn/app/image-asset-icon-resizer-lite/id1108313046?mt=12) ä¸€æ¬¾æ–¹ä¾¿çš„logoã€å¯åŠ¨é¡µç”Ÿæˆå·¥å…·æä¾›ä¸€ç§å°ºå¯¸çš„å›¾ç‰‡å¯å¿«é€Ÿç”Ÿæˆå…¶å®ƒå°ºå¯¸ã€‚æ”¯æŒAndroid ã€iOSç­‰

![Image Asset Icon Resizer Lite](https://upload-images.jianshu.io/upload_images/2828782-1ca927fecf6eeb49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800)

2ã€[GIPHY CAPTURE]( https://apps.apple.com/cn/app/giphy-capture-the-gif-maker/id668208984?mt=12) ä¸€æ¬¾å¾ˆå¥½ç”¨çš„gifå½•åˆ¶è½¯ä»¶ï¼Œæ–‡ç« ä½¿ç”¨åˆ°çš„gifå‡æ˜¯é€šè¿‡è¯¥è½¯ä»¶å½•åˆ¶è€Œæˆ

![GIPHY CAPTURE](https://upload-images.jianshu.io/upload_images/2828782-064b579e355f97df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800)

##  å…³äºæˆ‘

æ˜é‡‘: [AriesHoo](https://juejin.im/user/57c3cdcb5bbb50006341a6a4) 

ç®€ä¹¦: [AriesHoo](http://www.jianshu.com/u/a229eee96115)

GitHub: [AriesHoo](https://github.com/AriesHoo)

Email: AriesHoo@126.com

## License

```
Copyright 2019-2020 Aries Hoo

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

```
